# Vulnerability Detection with Fine-grained Interpretations

<p aligh="center"> This repository contains the code and data for <b>Vulnerability Detection with Fine-grained Interpretations</b> </p>

## Introduction

Despite the successes of machine learning-based vulnerability detectors (VD), they are limited to providing only the decision on whether a given code is vulnerable or not, without details on what part of the code is relevant to the detected vulnerability. We present IVDetect, an interpretable vulnerability detector with the philosophy of using Artificial Intelligence (AI) to detect vulnerabilities, while using Intelligence Assistant (IA) via providing VD interpretations
at the fine-grained level in term of vulnerable statements. For vulnerability detection, we separately consider the vulnerable statements and their surrounding contexts via data and control dependencies. This allows our model better discriminate vulnerable statements than using the mixture of vulnerable code and contextual code as in existing approaches. In addition to the coarsegrained vulnerability detection result, we leverage interpretable ML to provide users with fine-grained interpretations that include the sub-graph in the PDG with the crucial statements that are relevant to the detected vulnerability. Our empirical evaluation on vulnerability databases shows that IVDetect outperforms the existing ML-based approaches 64–122% and 105–255% in top-10 nDCG and MAP ranking scores. IVDetect correctly points out the vulnerable statements relevant to the vulnerability via its interpretations in 67% of the cases with a top-5 ranked list. It improves over ATT and GRAD interpretation models by 12.3–400% and 9–400% in accuracy.

----------

## Contents
1. [Dataset](#Dataset)
2. [Requirement](#Requirement)
3. [Settings](#Settings)
4. [Code](#Code)
5. [Reference](#Reference)

## Dataset

The Dataset we used in the paper:

Fan et al.[1]: https://drive.google.com/file/d/1-0VhnHBp9IGh90s2wCNjeCMuy70HPl8X/view?usp=sharing

Reveal [2]: https://drive.google.com/drive/folders/1KuIYgFcvWUXheDhT--cBALsfy1I4utOy

FFMPeg+Qemu [3]: https://drive.google.com/file/d/1x6hoF7G-tSYxg8AFybggypLZgMGDNHfF

Because we use Joern to generate AST and graphs and Joern is updating quickly with some functionality changes, to avoid the misleading, we do not provide the AST and graph generation script. Please go to Joern website: https://github.com/joernio/joern for more details on AST and graph generation.

We put an example csv dataset to show how the generated dataset looks like: https://drive.google.com/file/d/1skqs3d2uKT__igDsvWqKtHNojx69ToBo/view?usp=sharing

## Requirement

Please check all requirements in the requirement.txt

## Settings

Our approach can use NNI (Auto-ML) to tune the parameters. To do so, uncomment all lines with ```nni``` in ```main.py``` and comment line 195 in ```main.py```. Then run ```nnictl create --config config.yml``` to automatically tune the model parameters.

## Code

1. Please use ```git clone https://github.com/vulnerabilitydetection/VulnerabilityDetectionResearch.git``` to get the repository

2. Run ```gen_graphs.py```. The line 166 is the output dir.

3. Run ```glove/ash.sh``` and ```glove/pdg.sh``` to generate the GloVe embedding.

4. Run ```train_test_valid.py``` to split the dataset

5. Run ```main.py``` to train and test the model.

Pre-trained model can be downloaded from: https://drive.google.com/file/d/1S-yNGffEcY_AhPqP1NM-sacLkpnLUAIl/view?usp=sharing

## Reference

[1] Jiahao Fan, Yi Li, Shaohua Wang, and Tien Nguyen. 2020. A C/C++ Code Vulnerability Dataset with Code Changes and CVE Summaries. In The 2020 International Conference on Mining Software Repositories (MSR). IEEE.

[2] Saikat Chakraborty, Rahul Krishna, Yangruibo Ding, and Baishakhi Ray. 2020. Deep Learning based Vulnerability Detection: Are We There Yet? arXiv preprint arXiv:2009.07235 (2020).

[3] Yaqin Zhou, Shangqing Liu, Jingkai Siow, Xiaoning Du, and Yang Liu. 2019. Devign: Effective vulnerability identification by learning comprehensive program semantics via graph neural networks. In Advances in Neural Information Processing Systems. 10197–10207.
